<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="pro.dengyi.myhome.dao.FloorDao">
    <select id="selectFloorDto" resultType="pro.dengyi.myhome.model.dto.FloorDto">
        SELECT
            floor.id,
            floor.`name`,
            ( SELECT COUNT( id ) FROM room WHERE room.floor_id = floor.id ) AS roomCount,
            (
                SELECT
                    COUNT( device.id )
                FROM
                    device
                        INNER JOIN room ON device.room_id = room.id
                        INNER JOIN floor ON floor.id = room.floor_id
                        AND floor.id = floor.id
                WHERE
                    device.room_id = room.id
            ) AS deviceCount
        FROM
            floor
    </select>
</mapper>